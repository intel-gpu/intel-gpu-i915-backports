#  Intel® Graphics Driver Backports for Linux® OS (intel-gpu-i915-backports)

This branch provides i915 driver source code backported for Red Hat® Enterprise Linux® to enable intel discrete GPUs support.

We are using [backport project](https://backports.wiki.kernel.org/index.php/Main_Page) to generate out of tree i915 kernel module source codes.

This repo is a code snapshot of particular version of backports and does not contain individual git change history.

# Branches
 redhat/main will point to the currently supported version of Red Hat® Enterprise Linux®.
 
 We will add a new branch redhat/rhel<x.y> whenever a version is deprecated or moved to the maintenance phase.
  
# Supported Version/kernel
  Our current backport is based on Red Hat® Enterprise Linux® 8.6. We are using the header of the latest available kernel at the time of backporting. However, it may not be compatible with the latest version at the time of installation.
  Please refer [Version](https://github.com/intel-gpu/intel-gpu-i915-backports/blob/redhat/main/versions)
  file to check the RHEL_8.6_KERNEL_VERSION. It will point to the kernel version which is being used during backporting.

  In case of an issue with the latest kernel, please install the kernel version pointed by RHEL_8.6_KERNEL_VERSION.

    sudo dnf check-update; sudo dnf install -y kernel-<RHEL_8.6_KERNEL_VERSION>.el8_6.x86_64 \
    kernel-devel-<RHEL_8.6_KERNEL_VERSION>.el8_6.x86_64
    example:
	 sudo dnf check-update; sudo dnf install -y kernel-4.18.0-348.7.1.el8_5.x86_64 \
	 kernel-devel-4.18.0-348.7.1.el8_5.x86_64

# Product Releases:
Please refer [Releases](https://dgpu-docs.intel.com/releases/index.html)

# Prerequisite
we have dependencies on the following packages
  - dkms
  - make
  - lsb-release
  - rpm-build

        sudo dnf install -y dkms make lsb-release rpm-build

# Dependencies

This driver is part of a collection of kernel-mode drivers that enable support for Intel graphics. The backports collection within https://github.com/intel-gpu includes:

- [Intel® Graphics Driver Backports for Linux](https://github.com/intel-gpu/intel-gpu-i915-backports) - The main graphics driver (includes a compatible DRM subsystem and dmabuf if necessary)
- [Intel® Converged Security Engine Backports](https://github.com/intel-gpu/intel-gpu-cse-backports) - Converged Security Engine
- [Intel® Platform Monitoring Technology Backports](https://github.com/intel-gpu/intel-gpu-pmt-backports/) - Intel Platform Telemetry
- [Intel® GPU firmware](https://github.com/intel-gpu/intel-gpu-firmware) - Firmware required by intel GPUs.

Each project is tagged consistently, so when pulling these repos, pull the same tag.

# Dynamic Kernel Module Support(DKMS) based package creation

We need to create dmabuf and i915 dkms packages using the below command.

    make dkmsrpm-pkg

Above will create rpm packages at $HOME/rpmbuild/RPMS/x86_64/

# Installation

i915 driver has dependency on [VSEC(PMT)](https://github.com/intel-gpu/intel-gpu-pmt-backports/) and [MEI(CSE)](https://github.com/intel-gpu/intel-gpu-cse-backports), Please install VSEC and MEI before installting i915 driver.

    sudo rpm -ivh intel-dmabuf-dkms*.rpm intel-i915-dkms*.rpm
    # Reboot the device after installation of all packages.
    sudo reboot

## Blacklist base kernel dmabuf:
On redhat/main, along with i915 we are backporting dmabuf and drm. Since dmabuf is part of base kernel, we need to blacklist dmabuf by adding
"initcall_blacklist=sync_debugfs_init,dma_buf_init" in kernel command line.

## Installation varification
Please grep **backport**  from dmesg after reboot. you should see something like below

      > sudo dmesg |grep -i backport
    [sudo] password for gta:
    [2.684355] DMABUF-COMPAT BACKPORTED INIT
    [2.684371] Loading dma-buf modules backported from DII_5606_prerelease
    [2.684372] DMA BUF backport generated by backports.git RHEL_85_5606_PRERELEASE_220413.1
    [2.684910] I915 COMPAT BACKPORTED INIT
    [2.684911] Loading I915 modules backported from DII_5606_prerelease
    [2.684912] I915 Backport generated by backports.git RHEL_85_5606_PRERELEASE_220413.1
    [2.702432] [drm] DRM BACKPORTED INIT
    [2.724641] [drm] DRM_KMS_HELPER BACKPORTED INIT
    [2.838672] [drm] I915 BACKPORTED INIT


